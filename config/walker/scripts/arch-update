#!/bin/bash

echo "Starting Full System Update..."

# 1. Update Official Repos & AUR via yay
echo "--- Updating Pacman & AUR (yay) ---"
if yay -Syu; then
    echo "✅ Repo and AUR updates complete."
else
    echo "❌ yay update failed. Checking why..."
    exit 1
fi

# 2. Update Flatpaks
if command -v flatpak &> /dev/null; then
    echo "--- Updating Flatpaks ---"
    flatpak update --noconfirm
    # Optional: Clean up unused Flatpak runtimes
    flatpak uninstall --unused --y
else
    echo "ℹ️ Flatpak not installed, skipping..."
fi

# 3. Cleanup Orphans (Packages no longer needed)
echo "--- Checking for orphaned packages ---"
ORPHANS=$(pacman -Qdtq)
if [ -n "$ORPHANS" ]; then
    echo "Found orphans: $ORPHANS"
    sudo pacman -Rns $ORPHANS
else
    echo "✅ No orphans to remove."
fi

echo "✨ All updates and maintenance finished!"
